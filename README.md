# xml_converter
A Lua script for Aegisub to convert XML Danmaku file. 

---

# XML弹幕转换脚本
这是一个Aegisub脚本，用于导入xml格式的弹幕文件并将其转换为字幕，同时通过算法避免重叠问题。

**已经支持的功能**：
- 指定时间截取文件片段
- 指定弹幕在视频中的插入时间
- 过滤过长弹幕

**当前版本尚不支持的功能**：
- 弹幕着色
- 非滚动弹幕

## 《简单使用说明》

0. 脚本可用条件：
    - 使用前请先加载视频（空视频即可），防重叠算法需要获取视频的分辨率信息。
    - 将一行字幕（下文称为**启动行**）的 特效 改为`xmlconfig`，脚本则处于可使用状态。
1. 先在启动行配置好样式，其中**字体大小**将决定最终位置的计算结果（注意：*微软雅黑*字体在同等字体大小下显示大小要小于正常字体）。
2. 在启动行中添加`/pos`代码（可通过拖放字幕生成），则将`/pos`标签中的坐标作为**弹幕区域的下边界**。
3. 在启动行中，可以通过 `&参数名=值&` 的方式修改config表中的默认参数（一对`&&`中**只**指定一个参数，不区分大小写，无视空格）。
    - 你可以指定的参数主要有：
        - `duration` - 弹幕持续的时间(单位ms)
        - `interval` - 弹幕的前后上下间距(单位px)
        - `max_words` - 弹幕内容的最大字符串长度
        - `start_time` - 只选取xml弹幕文件的片段，并指定片段开始的时间(格式hh:mm:ss.ms)
        - `end_time` - 只选取xml弹幕文件的片段，并指定片段结束的时间(格式hh:mm:ss.ms)
        - `insert_time` - 弹幕字幕在当前视频中的开始时间(格式hh:mm:ss.ms)
5. 使用脚本后，会弹出文件选择对话框，选择需要转换的xml弹幕文件（请确保文件格式正确）。
6. 待运行完成后，会自动为你添加弹幕行，添加的弹幕行的特效被命名为`danmu from xml`，同时启动行会被自动标记为**注释**。

↓ **一个简单的范例**

![范例](https://github.com/muhz9786/xml_converter/blob/main/Example.png)
